<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Manipulative</title>

  <link rel="stylesheet" href="/manipulative.css">

</head>

<body>
  <div id="manipulative-canvas-root"></div>
  <script id="manipulative-js" type="module" src="/src/main.jsx"></script>

  <script>
    function saveState(data) {
      const id = Math.round(Math.random() * 100000);
      localStorage.setItem(id, data);
      const urlParams = new URLSearchParams(window.location.search);
      urlParams.set('id', id);
      window.location.search = urlParams;
    }

    function loadInitialState() {
      const urlParams = new URLSearchParams(window.location.search);
      const key = urlParams.get("id");
      return key ? localStorage.getItem(key) : null;
    }

    if (window.runManipulative) {
      window.runManipulative(saveState, loadInitialState());
    } else {
      document.querySelector('#manipulative-js').addEventListener('load', () => {
        window.runManipulative(saveState, loadInitialState());
      });
    }
  </script>
</body>

</html>